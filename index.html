<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shot Sync - Basketball Shot Analysis</title>
    <link rel="stylesheet" href="style.css">
    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- Firebase -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();
        
        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.googleProvider = googleProvider;
        window.signInWithGoogle = async () => {
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;
                return {
                    firstName: user.displayName?.split(' ')[0] || '',
                    lastName: user.displayName?.split(' ').slice(1).join(' ') || '',
                    email: user.email || ''
                };
            } catch (error) {
                console.error('Error signing in:', error);
                throw error;
            }
        };
        window.signOutUser = () => signOut(auth);
        window.onAuthStateChangedHandler = onAuthStateChanged;
        window.saveUserEmail = async (email, firstName, lastName) => {
            try {
                const user = auth.currentUser;
                if (user) {
                    await addDoc(collection(db, 'users'), {
                        userId: user.uid,
                        email: email,
                        firstName: firstName,
                        lastName: lastName,
                        createdAt: serverTimestamp()
                    });
                }
            } catch (error) {
                console.error('Error saving email:', error);
            }
        };
        window.saveAnalysis = async (userId, analysisData) => {
            try {
                await addDoc(collection(db, 'analyses'), {
                    userId: userId,
                    ...analysisData,
                    createdAt: serverTimestamp()
                });
            } catch (error) {
                console.error('Error saving analysis:', error);
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>üèÄ Shot Sync</h1>
                <p class="tagline">Professional Basketball Shot Analysis</p>
                <p class="subtitle">Record your shot and compare it to a benchmark</p>
            </div>
        </header>

        <div class="main-content">
            <!-- Step 0: User Information -->
            <section id="step0" class="step active">
                <h2>Get Started</h2>
                <p>Sign in with Google or enter your information below to receive your personalized shot analysis results via email.</p>
                
                <!-- Google Sign-In Button -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <button id="googleSignInBtn" class="btn" style="background: white; color: #333; border: 1px solid #ddd; display: inline-flex; align-items: center; gap: 10px; padding: 12px 24px;">
                        <svg width="18" height="18" viewBox="0 0 18 18">
                            <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                            <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                            <path fill="#FBBC05" d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.712 0-.595.102-1.172.282-1.712V4.956H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.044l3.007-2.332z"/>
                            <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.964 7.288C4.672 5.163 6.656 3.58 9 3.58z"/>
                        </svg>
                        Sign in with Google
                    </button>
                </div>
                
                <div style="text-align: center; margin: 20px 0; color: #666;">or</div>
                
                <form id="userInfoForm" class="email-form-section">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email">
                    </div>
                    <button type="submit" id="startAnalysisBtn" class="btn btn-primary">Start Analysis</button>
                </form>
            </section>

            <!-- Step 0.5: Player Selection -->
            <section id="step0_5" class="step" style="display: none;">
                <h2>Choose Your Benchmark</h2>
                <p>Compare your shot to a professional player or create your own custom benchmark.</p>
                <div class="player-selection">
                    <div class="player-grid">
                        <button class="player-btn" data-player="curry">
                            <div class="player-number">30</div>
                            <div class="player-name">Stephen Curry</div>
                            <div class="player-position">Guard</div>
                        </button>
                        <button class="player-btn" data-player="lebron">
                            <div class="player-number">23</div>
                            <div class="player-name">LeBron James</div>
                            <div class="player-position">Forward</div>
                        </button>
                        <button class="player-btn" data-player="jordan">
                            <div class="player-number">23</div>
                            <div class="player-name">Michael Jordan</div>
                            <div class="player-position">Guard</div>
                        </button>
                        <button class="player-btn" data-player="durant">
                            <div class="player-number">35</div>
                            <div class="player-name">Kevin Durant</div>
                            <div class="player-position">Forward</div>
                        </button>
                        <button class="player-btn" data-player="clark">
                            <div class="player-number">22</div>
                            <div class="player-name">Caitlin Clark</div>
                            <div class="player-position">Guard</div>
                        </button>
                        <button class="player-btn custom-btn" data-player="custom">
                            <div class="player-icon-custom">+</div>
                            <div class="player-name">Custom Benchmark</div>
                            <div class="player-description">Record your own ideal form</div>
                        </button>
                    </div>
                    <div class="custom-explanation" id="customExplanation" style="display: none;">
                        <p><strong>Custom Benchmark:</strong> First, record your ideal shooting form (the benchmark). Then record your shot to compare against it. This helps you establish your personal baseline and track improvement over time.</p>
                    </div>
                </div>
            </section>

            <!-- Step 1: Record Benchmark -->
            <section id="step1" class="step" style="display: none;">
                <h2 id="step1Title">Step 1: Record Benchmark Shot</h2>
                <p>Record a reference shot to use as your benchmark for comparison.</p>
                <div class="video-container">
                    <video id="benchmarkVideo" autoplay playsinline></video>
                    <canvas id="benchmarkCanvas" style="display: none;"></canvas>
                    <canvas id="benchmarkOutput" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                </div>
                <div class="controls">
                    <button id="startBenchmark" class="btn btn-primary">Start Recording</button>
                    <button id="stopBenchmark" class="btn btn-secondary" disabled>Stop Recording</button>
                    <button id="retakeBenchmark" class="btn btn-warning" style="display: none;">Retake</button>
                </div>
                <div id="benchmarkStatus" class="status"></div>
            </section>

            <!-- Step 2: Record User Shot -->
            <section id="step2" class="step" style="display: none;">
                <h2 id="step2Title">Step 2: Record Your Shot</h2>
                <p>Now record your own shot. We'll compare it to the benchmark and analyze your form.</p>
                <div class="video-container">
                    <video id="userVideo" autoplay playsinline></video>
                    <canvas id="userCanvas" style="display: none;"></canvas>
                    <canvas id="userOutput" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                </div>
                <div class="controls">
                    <button id="startUser" class="btn btn-primary">Start Recording</button>
                    <button id="stopUser" class="btn btn-secondary" disabled>Stop Recording</button>
                    <button id="retakeUser" class="btn btn-warning" style="display: none;">Retake</button>
                </div>
                <div id="userStatus" class="status"></div>
            </section>

            <!-- Step 3: Analysis Results -->
            <section id="step3" class="step" style="display: none;">
                <h2>Analysis Results</h2>
                <div id="loading" class="loading" style="display: none;">
                    <p>Analyzing your shot...</p>
                    <div class="spinner"></div>
                </div>
                <div id="results" style="display: none;">
                    <div class="score-section">
                        <h3 id="overallScore">Overall Score: --</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="feedback-section">
                        <h3>Feedback & Recommendations</h3>
                        <div id="feedbackList"></div>
                    </div>
                    
                    <!-- Email Success Message -->
                    <div id="emailSuccessSection" class="email-success-section" style="display: none;">
                        <div class="success-icon">‚úì</div>
                        <h3>Results Sent Successfully!</h3>
                        <p>Your shot analysis results have been sent to your email. Check your inbox for:</p>
                        <ul>
                            <li>Your personalized shot analysis graph</li>
                            <li>Detailed feedback and recommendations</li>
                            <li>Your overall score</li>
                        </ul>
                        <p class="thank-you">Thank you for using Shot Sync!</p>
                    </div>
                    
                    <div class="controls">
                        <button id="newComparison" class="btn btn-primary">New Comparison</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

